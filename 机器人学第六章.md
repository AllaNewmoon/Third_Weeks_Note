# 机器人定位
## 航迹推算
在前一位置的基础上根据预计的速度，方向和运行时间估计机器人下一位置的方法。

**1.机器人建模**：第一步需写出函数，描述机器人位形随时间的变化（设时间间隔内运动量很小，δ<k+1> = δ<k>*T~d~*R~θ~）。为了给误差建模，还需要增加连续随机变量。其中k为时间序号，v为噪声建模。
![](https://github.com/AllaNewmoon/123/blob/main/6.1.png?raw=true)

噪声遵循高斯分布，v ~ N(0, V)，其中V称为协方差矩阵，是一个对角阵，表明距离与航向上误差独立。

采用veh = Vehicle(V)，建立一个含噪声的自行车模型。利用odo = veh.step(1, 0.3)实现单步仿真，其中1为速度，0.3为转向角。利用veh.add_driver(RandomPath(10))进行长时间仿真，传入RandomPath的参数限定工作区域。veh.run()显示动画。

**补充**：

雅各比矩阵：f是一个自变量为向量的标量函数(R^n^->R)，求它对向量x（x1，x2，，xn）的导数，得到一个向量gratitude f(x)，其指向使f(x)具有最大增量的方向。

当f(x)含多个f1, f2,...fm时，对x求导组成的矩阵为雅各布矩阵。

**2.位姿估计**：对机器人模型f中的x<k>进行线性化，得到含雅可比矩阵F~x~和F~V~的式子，F~x~通过f对向量x求导得到，F~V~通过f对v求导得到。

在matlab中用vehicle类的方法Fx和Fv计算雅各比矩阵，从而可以写出EKF预测方程。

利用ekf = EKF(veh, V, P0)构造一个EKF对象，其中P0是R^3*3^的协方差矩阵，表示位形的不确定性。ekf.run(1000)执行1000个时间步，veh.plot_xy()绘制机器人走过路径

## 使用地图
采用map = LandmarkMap(20, 10)建立地图，20指路标数量，10表示x，y轴范围

采用sensor = RangeBearingSensor(veh, map, w)建立传感器模型，将机器人与地图关联。（w为2*2协方差矩阵）[z,i] = sensor.reading()随机获取一个路标的位置。

利用传感器可以得到观测值与估计值之间的差异（新息），从而得到卡尔曼增益矩阵。

ekf = EKF(veh, V, P0, sensor, W, map)创建基于传感器的估计器。同样可以绘制出预测轨迹和实际轨迹。（注意V是机器人协方差，W是传感器协方差）
  ![](https://github.com/AllaNewmoon/123/blob/main/6.2.png?raw=true)

## 创建地图
**基本逻辑**：机器人模型x<k+1> = f(x<k>, Θ<k>, v<k>) --> 对x<k>线性化，求导得雅各布矩阵 --> 建立EKF预测方程 --> 利用传感器建立观测函数，由机器人状态与特征物已知位置得到观测信息 --> 建立更新方程，减小误差

